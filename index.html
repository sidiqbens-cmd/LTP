<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ© Ø§Ù„Ù„ÙŠØ¨ÙŠØ© | Libyan Theses Portal</title>
    <style>
        :root { --primary: #1a2a3a; --accent: #3498db; --success: #27ae60; --light: #f8f9fa; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #e9ecef; margin: 0; padding: 5px; font-size: 12px; color: #333; }
        .dashboard { max-width: 1250px; margin: auto; background: white; border-radius: 4px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); overflow: hidden; height: 98vh; display: flex; flex-direction: column; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ø¯Ù…Ø¬ Ø¨Ø§Ù„Ù„ØºØªÙŠÙ† */
        header { background: var(--primary); color: white; padding: 8px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid var(--accent); }
        header h1 { margin: 0; font-size: 1.1rem; letter-spacing: 0.5px; }
        .lang-en { font-family: Arial, sans-serif; font-size: 0.9rem; opacity: 0.9; margin-right: 10px; border-right: 1px solid #555; padding-right: 10px; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙØ§Ø¦Ù‚Ø© Ø§Ù„ÙƒØ«Ø§ÙØ© */
        .entry-section { padding: 10px; background: var(--light); border-bottom: 1px solid #ddd; }
        .grid-container { display: grid; grid-template-columns: repeat(6, 1fr); gap: 6px; }
        .full { grid-column: span 6; }
        .triple { grid-column: span 3; }
        .double { grid-column: span 2; }
        
        input, select { padding: 4px 8px; border: 1px solid #bbb; border-radius: 3px; width: 100%; box-sizing: border-box; font-size: 12px; height: 28px; }
        input:focus { border-color: var(--accent); outline: none; box-shadow: 0 0 3px rgba(52,152,219,0.3); }
        label { display: block; margin-bottom: 1px; font-weight: 600; font-size: 11px; color: #444; }

        .btn-group { margin-top: 8px; display: flex; gap: 6px; justify-content: flex-end; align-items: center; }
        button { padding: 5px 15px; border: none; border-radius: 3px; cursor: pointer; font-weight: bold; font-size: 11px; }
        .btn-save { background: var(--success); color: white; }
        .btn-export { background: #6c757d; color: white; }
        .btn-excel { background: #217346; color: white; } /* Ù„ÙˆÙ† Ø§Ù„Ø¥ÙƒØ³Ù„ Ø§Ù„Ø´Ù‡ÙŠØ± */

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬ */
        .search-section { padding: 10px; flex-grow: 1; display: flex; flex-direction: column; overflow: hidden; }
        .search-bar { margin-bottom: 8px; display: flex; gap: 8px; background: #eee; padding: 6px; border-radius: 4px; }
        
        .table-wrapper { flex-grow: 1; overflow-y: auto; border: 1px solid #eee; }
        .dense-table { width: 100%; border-collapse: collapse; font-size: 11.5px; }
        .dense-table th { background: #f1f1f1; padding: 6px; text-align: right; border: 1px solid #ddd; position: sticky; top: 0; color: var(--primary); }
        .dense-table td { padding: 4px 6px; border: 1px solid #eee; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .dense-table tr:hover { background: #f9f9f9; }
        
        .status-badge { padding: 1px 5px; border-radius: 4px; font-size: 9px; color: white; font-weight: bold; }
        .available { background: var(--success); }
        .not-available { background: #d9534f; }
    </style>
</head>
<body>

<div class="dashboard">
    <header>
        <h1>
            <span>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ© Ø§Ù„Ù„ÙŠØ¨ÙŠØ©</span>
            <span class="lang-en">Libyan Theses Portal (LTP)</span>
        </h1>
        <div style="font-size: 10px;">Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù„ÙŠØ¨ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯ v1.0</div>
    </header>

    <div class="entry-section">
        <div class="grid-container">
            <div class="triple"><label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label><input type="text" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„..."></div>
            <div class="double"><label>Ø§Ù„Ø¨Ø§Ø­Ø«</label><input type="text"></div>
            <div class="double"><label>Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø¹Ù„Ù…ÙŠ</label><input type="text"></div>
            
            <div><label>Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©</label>
                <select>
                    <option>Ø¬Ø§Ù…Ø¹Ø© Ø·Ø±Ø§Ø¨Ù„Ø³</option>
                    <option>Ø¬Ø§Ù…Ø¹Ø© Ø¨Ù†ØºØ§Ø²ÙŠ</option>
                    <option>Ø¬Ø§Ù…Ø¹Ø© Ø³Ø¨Ù‡Ø§</option>
                </select>
            </div>
            <div><label>Ø§Ù„ÙƒÙ„ÙŠØ©/Ø§Ù„Ù‚Ø³Ù…</label><input type="text"></div>
            <div><label>Ø§Ù„Ø³Ù†Ø©</label><input type="number" value="2026"></div>
            <div><label>Ø±Ù‚Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label><input type="text"></div>
            <div><label>Ø§Ù„Ø¯Ø±Ø¬Ø©</label><select><option>Ù…Ø§Ø¬Ø³ØªÙŠØ±</option><option>Ø¯ÙƒØªÙˆØ±Ø§Ù‡</option></select></div>
            <div><label>Ø§Ù„Ø­Ø§Ù„Ø©</label><select><option>Ù…ØªÙˆÙØ±Ø©</option><option>ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</option></select></div>
            
            <div class="triple"><label>Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø³ØªØ®Ù„Øµ Ø£Ùˆ Ø§Ù„Ø±Ø³Ø§Ù„Ø© (URL)</label><input type="url" placeholder="https://..."></div>
            <div class="triple btn-group">
                <button class="btn-excel">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Excel</button>
                <button class="btn-export">ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª</button>
                <button class="btn-save">Ø­ÙØ¸ ÙÙŠ Ø§Ù„ÙÙ‡Ø±Ø³</button>
            </div>
        </div>
    </div>

    <div class="search-section">
        <div class="search-bar">
            <input type="text" style="flex-grow: 2" placeholder="Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹ Ø¨Ø§Ù„Ø¹Ù†ÙˆØ§Ù†ØŒ Ø§Ù„Ø¨Ø§Ø­Ø«ØŒ Ø§Ù„Ù…Ø´Ø±Ù...">
            <select style="flex-grow: 1"><option>ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©</option></select>
            <select style="flex-grow: 1"><option>ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø³Ù†Ø©</option></select>
        </div>
        
<div class="table-wrapper">
            <table class="dense-table">
                <thead>
                    <tr>
                        <th width="5%">Ø±Ù‚Ù…</th>
                        <th width="35%">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                        <th width="20%">Ø§Ù„Ø¨Ø§Ø­Ø« / Ø§Ù„Ù…Ø´Ø±Ù</th>
                        <th width="15%">Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©</th>
                        <th width="10%">Ø§Ù„Ø³Ù†Ø©</th>
                        <th width="15%">Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø·</th>
                    </tr>
                </thead>
                <tbody id="results-body">
                    </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // 1. ÙˆØ¸ÙŠÙØ© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…Ù„Ù Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù…ÙˆØ­Ø¯
    async function loadData() {
        try {
            // Ù†Ù‚ÙˆÙ… Ø¨Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø°ÙŠ ÙŠØµÙ†Ø¹Ù‡ Ø§Ù„Ù€ GitHub Action ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            const response = await fetch('data/master_index.json');
            if (!response.ok) return; // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ØŒ Ù„Ø§ ØªÙØ¹Ù„ Ø´ÙŠØ¦Ø§Ù‹
            const items = await response.json();
            
            const tbody = document.getElementById('results-body');
            tbody.innerHTML = ''; // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ù† Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¯ÙŠÙ…Ø©
            
            items.forEach((item, index) => {
                const row = `
                    <tr>
                        <td>${index + 1}</td>
                        <td style="font-weight:bold">${item.title}</td>
                        <td>${item.author} / ${item.supervisor}</td>
                        <td>${item.university}</td>
                        <td>${item.year}</td>
                        <td>
                            <span class="status-badge ${item.status === 'Ù…ØªÙˆÙØ±Ø©' ? 'available' : 'not-available'}">
                                ${item.status}
                            </span>
                        </td>
                    </tr>`;
                tbody.insertAdjacentHTML('beforeend', row);
            });
        } catch (e) {
            console.log("ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...");
        }
    }

    // 2. ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø­ÙŠ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
document.querySelector('.btn-save').onclick = function() {
    const data = {
        title: document.querySelector('input[placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„..."]').value,
        author: document.querySelectorAll('input')[0].value, // Ø£ÙˆÙ„ Ø®Ø§Ù†Ø© Ø¥Ø¯Ø®Ø§Ù„
        university: document.querySelector('select').value,
        year: document.querySelector('input[type="number"]').value,
        status: "Ù…ØªÙˆÙØ±Ø©"
    };
    
    const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `thesis-${Date.now()}.json`; // Ø³ÙŠØ­Ù…Ù„ Ø§Ù„Ù…Ù„Ù Ø¨Ø§Ø³Ù… Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø­Ø§Ù„ÙŠ
    a.click();
    alert("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù! Ø±ÙØ¹Ù‡ Ø§Ù„Ø¢Ù† Ø¥Ù„Ù‰ Ù…Ø¬Ù„Ø¯ data ÙÙŠ GitHub Ù„ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹.");
};

    // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¬Ù„Ø¨ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
    window.onload = loadData;
</script>
    // 1. Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
    async function loadTheses() {
        try {
            const response = await fetch('data/master_index.json');
            if (!response.ok) throw new Error('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯');
            const data = await response.json();
            displayData(data);
        } catch (err) {
            console.log("ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø±ÙØ¹ Ø£ÙˆÙ„ Ù…Ù„ÙØ§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...");
        }
    }

    // 2. ÙˆØ¸ÙŠÙØ© Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
function displayData(items) {
    const tbody = document.getElementById('results-body');
    if(!tbody) return;
    
    tbody.innerHTML = ''; // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù‚Ø¨Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    
    items.forEach((item, index) => {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØµÙÙˆÙ Ø§Ù„ÙØ§Ø±ØºØ©
        if(!item.title) return; 

        const row = `
            <tr>
                <td style="text-align:center;">${index + 1}</td>
                <td style="font-weight:bold;">${item.title}</td>
                <td>${item.author} <br> <small style="color: #666;">Ø¥Ø´Ø±Ø§Ù: ${item.supervisor}</small></td>
                <td>${item.university}</td>
                <td style="text-align:center;">${item.year}</td>
                <td style="text-align:center;">
                    <span class="status-badge ${item.status === 'Ù…ØªÙˆÙØ±Ø©' ? 'available' : 'not-available'}">
                        ${item.status}
                    </span>
                    ${item.url ? `<a href="${item.url}" target="_blank" title="ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø·" style="text-decoration:none; margin-right:5px;">ğŸ”—</a>` : ''}
                </td>
            </tr>`;
        
        tbody.insertAdjacentHTML('beforeend', row);
    });
}

    // 3. ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ø­ÙØ¸ (Ø§Ù„ØªØµØ¯ÙŠØ± Ù„Ù„Ù…ÙƒØªØ¨Ø§Øª)
    document.querySelector('.btn-save').onclick = function() {
        const data = {
            title: document.getElementById('title').value,
            author: document.getElementById('author').value,
            supervisor: document.getElementById('supervisor').value,
            university: document.getElementById('uni').value,
            year: document.querySelector('input[type="number"]').value,
            id: document.getElementById('sid').value,
            status: document.querySelectorAll('select')[2].value
        };
        
        if(!data.title) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†");

        const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `thesis-${data.id || Date.now()}.json`;
        a.click();
    };

    // 4. ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø­ÙŠ
    document.querySelector('.search-bar input').onkeyup = function() {
        let filter = this.value.toUpperCase();
        let trs = document.querySelectorAll(".dense-table tbody tr");
        trs.forEach(tr => {
            tr.style.display = tr.textContent.toUpperCase().includes(filter) ? "" : "none";
        });
    };

    // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¬Ù„Ø¨ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    window.onload = loadTheses;
</script>
</body>
</html>
