<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Libyan Theses Portal | LTP</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        :root { --libya-red: #e74c3c; --libya-green: #27ae60; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 2px; font-size: 15px; }
        
        /* ترويسة ألوان العلم */
        header { background: white; border-bottom: 4px solid #000; padding: 10px; text-align: center; }
        .h-red { color: var(--libya-red); font-size: 18px; margin: 0; font-weight: bold; }
        .h-black { color: #000; font-size: 55px; font-weight: 900; margin: 0; line-height: 1; }
        .h-green { color: var(--libya-green); font-size: 18px; margin: 0; font-weight: bold; }

        /* منطقة الإدخال المكثفة */
        .entry-section { background: #fff; border: 1px solid #ddd; padding: 8px; border-radius: 4px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; margin-bottom: 5px; }
        input, select { height: 32px; border: 1px solid #ccc; border-radius: 3px; padding: 0 8px; font-size: 14px; width: 100%; box-sizing: border-box; }
        input:focus { border-color: var(--libya-green); outline: none; background: #fffffc; }

        .btn-row { display: flex; gap: 8px; justify-content: center; margin: 8px 0; }
        button { height: 35px; padding: 0 20px; border: none; border-radius: 4px; cursor: pointer; color: white; font-weight: bold; }
        .btn-save { background: var(--libya-green); }
        .btn-excel { background: #2d3436; }
        .btn-tmp { background: #7f8c8d; }

        /* التصفية والبحث */
        .filter-bar { background: #ececec; padding: 6px; display: flex; gap: 10px; border-right: 5px solid var(--libya-green); margin-bottom: 5px; }

        /* الجدول */
        .table-wrap { height: 55vh; overflow-y: auto; background: white; border: 1px solid #ddd; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th { background: #f8f9fa; position: sticky; top: 0; padding: 8px; border: 1px solid #ddd; z-index: 5; }
        td { padding: 6px; border: 1px solid #eee; text-align: center; }
        .title-td { text-align: right; font-weight: bold; }
        tr:nth-child(even) { background: #fafafa; }
        .btn-act { padding: 2px 8px; font-size: 11px; margin: 0 2px; }
    </style>
</head>
<body>

<header>
    <p class="h-red">بوابة الرسائل الجامعية</p>
    <p class="h-black">LTP</p>
    <p class="h-green">Libyan Theses Portal</p>
</header>

<div class="entry-section">
    <input type="text" id="f-title" placeholder="عنوان الرسالة" class="nav" style="grid-column: span 2;">
    <input type="text" id="f-author" placeholder="اسم الباحث" class="nav">
    <input type="text" id="f-supervisor" placeholder="المشرف" class="nav">
    <select id="f-uni" class="nav">
        <option value="">الجامعة</option><option>طرابلس</option><option>بنغازي</option><option>سبها</option><option>الزاوية</option><option>مصراتة</option>
    </select>
    <select id="f-college" class="nav"><option value="">الكلية</option><option>الآداب</option><option>الهندسة</option><option>العلوم</option><option>الاقتصاد</option></select>
    <select id="f-dept" class="nav"><option value="">القسم</option><option>المكتبات</option><option>الحاسوب</option><option>التربية</option></select>
    <input type="number" id="f-year" value="2026" class="nav">
    <input type="text" id="f-loc" placeholder="مكان الرسالة (المكتبة)" class="nav" style="grid-column: span 2;">
    <input type="text" id="f-id" placeholder="رقم الرسالة / التصنيف" class="nav">
</div>

<div class="btn-row">
    <button class="btn-save" id="btnSave">حفظ لحظي (Enter)</button>
    <button class="btn-excel" onclick="document.getElementById('xl').click()">استيراد Excel</button>
    <button class="btn-tmp" onclick="downloadTemplate()">تحميل القالب</button>
    <input type="file" id="xl" style="display:none" accept=".xlsx">
</div>

<div class="filter-bar">
    <strong>تصفية سريعة:</strong>
    <input type="text" id="s-title" placeholder="بحث بالعنوان أو القسم..." style="flex:1">
    <select id="s-dept"><option value="">كل الأقسام</option><option>المكتبات</option></select>
</div>

<div class="table-wrap">
    <table>
        <thead>
            <tr>
                <th width="40%">العنوان والباحث</th>
                <th>القسم والكلية</th>
                <th>المكان</th>
                <th width="80px">الرقم</th>
                <th width="60px">السنة</th>
                <th width="120px">إجراءات</th>
            </tr>
        </thead>
        <tbody id="rows"></tbody>
    </table>
</div>

<script>
    // بيانات الربط الخاصة بك
    const firebaseConfig = {
      apiKey: "AIzaSyBU-Y2l1rrpAPOpDhEXI7WjwACx0LgZLX0",
      authDomain: "ltp-libya.firebaseapp.com",
      projectId: "ltp-libya",
      appId: "1:761649252036:web:96e615cae0a5584f3bab91"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // التنقل بـ Enter
    const navs = document.querySelectorAll('.nav
